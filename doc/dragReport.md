# 拖拽自定义报表

## 介绍
该项目起源于公司内部的需求，本人在司维护开发的项目具有大量相似的报表页面，而最近又接到三个雷同页面，该项目应运而生。

项目在电脑端，遂工具制作成了拖动完成排版的形式，方便可爱的运维小姐姐操作。

推荐使用 `chrome` 浏览器食用更佳。

## 演示
![待补充演示图](../src/assets/img/dragReport/col-24-0.png)

## 说明
在拖动页面实际拖动的就是一个拥有背景的 `div`，在预览页面才会生成其对应的那个组件。

### 插件说明
- `echarts` 百度可视化图表库
- `element-ui` 饿了么组件库
- `ramda` 函数式编程顶好的库之一
- `jspdf` 结合 `html2canvas` 实现 pdf 导出功能
- `html2canvas` 结合 `jspdf` 实现 pdf 导出功能
- `lodash` 暂且只使用了 debounce 函数
- `mockjs` 前端随机数生成工具

### 结构说明
项目主要由两个页面构成，第一个页面主要为拖动编辑排版，第二个页面为预览编辑的页面。

拖动页面所需通识。
- 页面由行（`row`）组成，每一行又由列又称组件（`col`）组成。
- `row` 间可以进行拖动更改位置，`col` 间可以进行拖动更改位置。
- 关键点在于点击某一组件的时候要存储该组件的值。

预览页面所需通识。
- Vue 动态组件。

### 组件说明


### 小部件说明
`clickoutside` 来自于 `element-ui` 的源码，用于判断用户是否点击某一元素。

### 优化说明
本来的想法是一个组件对应一个接口，现在对相同接口的组件进行了优化，如果接口相同则只会调用一遍接口

## 代办事项
调用接口所传输的数据每个接口需要相同，拟改为可以自定义传输的数据

拟把行的高度也改为可以自定义的，这时候就需要一个行内垂直的排序方式

拟将 `drag` 改为 `mousedown` 等，进行低版本浏览器的兼容

## 后语
- 该项目中困难的并非是该如何实现拖拽功能，真正困难的是数据格式的设计，由于该工具为前端主导后端为辅，数据格式大的调整有过三次，一次是格式问题，不能实现我想要的功能，两次是格式优化，考虑到要存储到数据库，遂对所需格式又进行了一次优化。
- 样式整理也是一个比较令人头秃的一个点，在初版完成之后的改版优化中，我一边改一边骂自己是个傻X，还好有 `sass` 的存在，让我减少了不少工作量，但是不能否认的是项目中还是有许多辣鸡代码（何谓辣鸡代码，就是让我看一遍也会想拍死作者，即使是自己写的），还是需要做优化。
- 在预览报表的页面，由于了解过 `Vue` 的 `component` 组件，所以实现起来也并非什么难事，关键点在于每个组件对外接收的 `prop` 要做到统一，这不仅是为了方便管理，任何一个强大的框架都需要有人来维护，这也是为了减少后面接手的人的理解成本。
- 在框架搭建完成之后，组件式报表的业务重点就在于大量的组件，本来的写法是写一个组件在预览页面引用一个，但是在看 [vue-element-admin](https://github.com/PanJiaChen/vue-element-admin) 的源码的时候，发现了 `webpack` 的 `require.context` 这个令人着迷的 `API`，那还能忍？盘他，于是，就有了 `src\views\previewReport\index.js` 这个文件的诞生，只要组件命名规范，我就会自动引入该组件，方便省心，比充X娃娃还好使。
- 另外，由于这样的页面大都不仅是用来看看，都会结合一下 `pdf` 导出的功能，遂查阅相关资料做了一个 `pdf` 导出的功能，前端实现 `pdf` 导出功能的思想就是通过 `dom` 来生成 `canvas`，然后又借助于 `canvas` 的 `API` 获取图片的 `base64` 码，最后通过 `jspdf` 生成 `pdf`。